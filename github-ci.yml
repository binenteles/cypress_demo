name: Generate Cypress Report
on: 
  push:
    branches:
      - 'main'
  jobs:
    cypress-test:
      name: Run on Chrome 134
      runs-on: ubuntu-24.04
      container: cypress/browsers:node-22.14.0-chrome-134.0.6998.88-1-ff-136.0.1-edge-134.0.3124.51-1
      steps:
        - uses: actions/checkout@v4
        
        - name: Install cypress and verify
          run: |
            npm ci
            $(npm bin)/cypress verify

        - name: Run Cypress tests
          run: npm run test:chrome
          continue-on-error: false

        - name: Copy test execution video and screenshots
          run: |
            mkdir public
            cp -r cypress/videos public/videos
            cp -r cypress/screenshots public/screenshots

        - name: Merge test reports
          run: npm run combine:report

        - name: Generate HTML report
          run: npm run generate:report

        - name: Deploy report page on Github Page
          uses: peaceiris/actions-gh-pages@v4
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            publish_dir: ./public